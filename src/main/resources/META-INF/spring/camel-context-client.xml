<?xml version="1.0" encoding="UTF-8"?>
<!-- Configures the Camel Context-->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:cxf="http://camel.apache.org/schema/cxf"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/cxf http://camel.apache.org/schema/cxf/camel-cxf.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">

  	<cxf:rsClient id="rsClient" address="http://localhost:8080/kie-server/services/rest/server/containers/containerweightwatchers10"
	   serviceClass="org.blogdemo.endpoint.CustEval"
	   username="erics"
	   password="jbossbrms1!"
	   loggingFeatureEnabled="true" >
	  	<cxf:providers>
	   		<bean class="org.apache.cxf.jaxrs.provider.JAXBElementProvider"/>
		</cxf:providers>
		<cxf:headers>
	   		<cxf:entry key="Charset" value="UTF-8"/>
	   		<cxf:entry key="X-KIE-ContentType" value="xstream"/>
		</cxf:headers>
   	</cxf:rsClient>
   	
   	<!--  <bean id="amqConnectionFactory" class="io.fabric8.mq.core.MQConnectionFactory">
   		<property name="userName" value="admin"/>
		<property name="password" value="admin"/>
	</bean>
	<bean id="amq" class="io.fabric8.mq.camel.AMQComponent"></bean>-->
	
	<bean id="activemq" class="org.apache.activemq.camel.component.ActiveMQComponent">
      <property name="brokerURL" value="tcp://localhost:61616"/>
      <property name="userName" value="admin"/>
      <property name="password" value="admin"/>
  	</bean>
  
  	<camelContext xmlns="http://camel.apache.org/schema/spring">
  
  
	  <route id="input">
	    <from uri="amq:queue:WEIGHTWATCHER"/>
	    <to uri="direct:callBRMS"/>
	  </route>
	  <route id="callBRMS">
	    <from uri="direct:callBRMS"/>
	    <log message="The message from QUEUE ${body}"/>
	    <removeHeaders pattern="CamelHttpPath" />
	    <to uri="cxfrs:bean:rsClient?exchangePattern=InOut"/>
	    <convertBodyTo type="java.lang.String"/>
	    <log message="The message from BRMS ${body}"/>
	  </route>
  
</camelContext>

</beans>
